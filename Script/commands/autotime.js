const moment = require("moment-timezone");
const fs = require("fs-extra");

const settingsPath = __dirname + "/autotime-settings.json";

// à¦ªà§à¦°à¦¾à¦¥à¦®à¦¿à¦• à¦¸à§‡à¦Ÿà¦¿à¦‚à¦¸ (à¦¯à¦¦à¦¿ à¦«à¦¾à¦‡à¦² à¦¨à¦¾ à¦¥à¦¾à¦•à§‡)
if (!fs.existsSync(settingsPath)) {
    fs.writeFileSync(settingsPath, JSON.stringify({ enabled: true }, null, 2));
}

const groupThreads = [
    "30711769645137573",
    "30071079139202549",
    "24084870691105207",
    "30581847821463512",
    "9975530682575328"
];

const messages = {
    "00:00": "à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§§à§¨ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦®à§‹à¦¬à¦¾à¦‡à¦² à¦°à¦¾à¦– à¦˜à§à¦®à¦¾...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜•",
    "01:00": "à¦°à¦¾à¦¤ à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà¦¤à§‡ à¦šà¦²à¦²à§‹, à¦¤à§‹à¦°à¦¾ à¦šà§à¦¯à¦¾à¦Ÿà¦¿à¦‚ à¦…à¦« à¦•à¦°...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ™‚",
    "02:00": "à¦°à¦¾à¦¤ à§¨à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ ðŸ™‚, à¦¤à§‹à¦¦à§‡à¦° à¦•à¦¿ à¦˜à§à¦® à¦†à¦¸à§‡à¦¨à¦¾..? ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ¤¨",
    "03:00": "à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§©à¦Ÿà¦¾, à¦¸à¦¬à¦¾à¦‡ à¦˜à§à¦® à¦†à¦° à¦¤à§‹à¦°à¦¾ à¦œà§‡à¦—à§‡ à¦†à¦›à¦¿à¦¸ à¦®à¦¾à¦¨à§‡ à¦¤à§‹à¦°à¦¾ à¦¬à¦²à¦¦...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ™‚",
    "04:00": "à¦­à§‹à¦° à§ªà¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦à¦•à¦Ÿà§ à¦ªà¦° à¦†à¦œà¦¾à¦¨ à¦¦à¦¿à¦¬à§‡...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ¥°",
    "05:00": "à¦à¦–à¦¨ à¦­à§‹à¦° à§«à¦Ÿà¦¾, à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà¦°à¦¸à§‹?...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ‘€",
    "06:00": "à¦¸à¦•à¦¾à¦² à§¬à¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦²à§‹, à¦†à¦®à¦¿ à¦à¦•à¦¾à¦‡ à¦‰à¦ à§‡ à¦ªà¦°à¦¸à¦¿...! ðŸŒ»ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ’œ",
    "07:00": "à§­à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦¤à§‹à¦°à¦¾ à¦à¦–à¦¨à§‹ à¦˜à§à¦®à¦¾à¦¸..! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ¤”",
    "08:00": "à¦¸à¦•à¦¾à¦² à§®à¦Ÿà¦¾, à¦˜à§à¦® à¦¥à§‡à¦•à§‡ à¦‰à¦ à§‡ à¦ªà¦°...!ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒ ðŸ¤§",
    "09:00": "à§¯à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¤à¦¾à¦“ à¦¬à¦¿à¦›à¦¾à¦¨à¦¾ à¦›à¦¾à§œà¦¿à¦¸ à¦¨à¦¾ à¦•à§‡à¦¨..?ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜’", 
    "10:00": "à§§à§¦à¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦²à§‹, à¦œà¦®à¦¿à¦¦à¦¾à¦°à§‡à¦° à¦¸à¦¨à§à¦¤à¦¾à¦¨à¦°à¦¾ à¦à¦–à¦¨ à¦¨à¦¾à¦¸à§à¦¤à¦¾ à¦•à¦°à§‡ à¦«à§‡à¦²à§‹..! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ™‚",
    "11:00": "à§§à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦•à¦¿à¦¨à§à¦¤à§ à¦¸à¦®à§Ÿ à¦•à¦¾à¦Ÿà¦›à§‡ à¦¨à¦¾..!ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜–",
    "12:00": "à¦¦à§à¦ªà§à¦° à§§à§¨à¦Ÿà¦¾, à¦•à¦¿ à¦–à¦¬à¦° à¦¤à§‹à¦®à¦¾à¦¦à§‡à¦°..? ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜Œ",
    "13:00": "à§§à¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦¸à§‡, à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à§‡à¦“..! ðŸ’œð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸŒ»",
    "14:00": "à¦¦à§à¦ªà§à¦° à§¨à¦Ÿà¦¾, à¦¸à¦¬à¦¾à¦‡ Lunch à¦•à¦°à§‡ à¦«à§‡à¦²à§‹...! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜‹",
    "15:00": "à¦¦à§à¦ªà§à¦° à§©à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦à¦•à¦Ÿà§ à¦˜à§à¦®à¦¾à¦“..! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ«¶",
    "16:00": "à¦¬à¦¿à¦•à§‡à¦² à§ªà¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦¸à§‡, à¦®à¦¾à¦ à§‡ à¦¯à¦¾à¦“ à¦–à§‡à¦²à¦¾à¦§à§à¦²à¦¾ à¦•à¦°à§‹..! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ‘Š",
    "17:00": "à¦à¦–à¦¨ à¦¬à¦¿à¦•à§‡à¦² à§«à¦Ÿà¦¾, à¦†à¦¸à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¾à¦“...! ðŸ˜Œð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸŒ»",
    "18:00": "à§¬à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à¦¹à§Ÿà§‡ à¦—à§‡à¦²à§‹...!ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒ ðŸŒ†",
    "19:00": "à§­à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà¦¤à§‡ à¦¯à¦¾à¦“..! ðŸ’œð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ«¶",
    "20:00": "à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§®à¦Ÿà¦¾, à¦à¦•à¦Ÿà§ à¦ªà§œà¦¤à§‡ à¦¬à¦¸à§‹..! ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜’",
    "21:00": "à¦°à¦¾à¦¤ à§¯à¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦²à§‹, à¦•à¦¿ à¦•à¦°à¦›à§‹ à¦¤à§‹à¦®à¦°à¦¾...? ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ«£",
    "22:00": "à¦°à¦¾à¦¤ à§§à§¦à¦Ÿà¦¾ Dinner à¦Ÿà¦¾à¦‡à¦®, à¦–à¦¾à¦‡à¦¸à§‹ à¦¨à¦¾à¦•à¦¿ à¦–à¦¾à¦¬à¦¾? ðŸ˜‹ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ’œ",
    "23:00": "à¦°à¦¾à¦¤ à§§à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦¶à§à§Ÿà§‡ à¦ªà§œà§‹ à¦¸à¦¾à¦°à¦¾à¦¦à¦¿à¦¨ à¦•à§à¦²à¦¾à¦¨à§à¦¤ à¦›à¦¿à¦²à§‡...!ð™ðˆð’ð€ð ð€ð‡ðŒð„ðƒðŸ˜‡"
};

module.exports.config = {
    name: "autotime",
    version: "1.1.0",
    hasPermssion: 0,
    credits: "ð…ðžð«ðð¨ð®ð¬ ð–ðšð¡ð¢ð",
    description: "à¦¢à¦¾à¦•à¦¾ à¦¸à¦®à§Ÿ à¦…à¦¨à§à¦¯à¦¾à§Ÿà§€ à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦¸à¦®à§Ÿà§‡ à¦—à§à¦°à§à¦ªà§‡ à¦®à§‡à¦¸à§‡à¦œ à¦ªà¦¾à¦ à¦¾à¦¬à§‡ (on/off à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦¸à¦¹)",
    commandCategory: "automation",
    usages: "[on/off]",
    cooldowns: 3
};

let intervalID = null;

module.exports.onLoad = function ({ api }) {
    const settings = JSON.parse(fs.readFileSync(settingsPath));
    if (settings.enabled) {
        startAutoTime(api);
    }
};

module.exports.run = function ({ api, event, args }) {
    const settings = JSON.parse(fs.readFileSync(settingsPath));

    if (args[0] === "on") {
        if (settings.enabled) return api.sendMessage("â³ Autotime à¦†à¦—à§‡à¦‡ à¦šà¦¾à¦²à§ à¦†à¦›à§‡!", event.threadID);
        settings.enabled = true;
        fs.writeFileSync(settingsPath, JSON.stringify(settings, null, 2));
        startAutoTime(api);
        return api.sendMessage("âœ… Autotime à¦šà¦¾à¦²à§ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡!", event.threadID);
    }

    if (args[0] === "off") {
        if (!settings.enabled) return api.sendMessage("â³ Autotime à¦†à¦—à§‡à¦‡ à¦¬à¦¨à§à¦§ à¦†à¦›à§‡!", event.threadID);
        settings.enabled = false;
        fs.writeFileSync(settingsPath, JSON.stringify(settings, null, 2));
        stopAutoTime();
        return api.sendMessage("â›” Autotime à¦¬à¦¨à§à¦§ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡!", event.threadID);
    }

    return api.sendMessage("ðŸ“Œ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦°: autotime on / autotime off", event.threadID);
};

function startAutoTime(api) {
    if (intervalID) clearInterval(intervalID);

    intervalID = setInterval(() => {
        const currentTime = moment().tz("Asia/Dhaka").format("HH:mm");
        if (messages[currentTime]) {
            groupThreads.forEach(threadID => {
                api.sendMessage(messages[currentTime], threadID);
            });
        }
    }, 60 * 1000);
}

function stopAutoTime() {
    if (intervalID) {
        clearInterval(intervalID);
        intervalID = null;
    }
  }
